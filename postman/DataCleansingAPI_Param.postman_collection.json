{
	"info": {
		"_postman_id": "data-cleansing-api-collection",
		"name": "Data Cleansing API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "2575375"
	},
	"item": [
		{
			"name": "Data Health Monitoring",
			"item": [
				{
					"name": "Generate Inconsistency Report",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"response is ok\",  ()=>{\r",
									"    pm.response.to.have.status(200)\r",
									"})\r",
									"\r",
									"pm.test(\"response has correct structure\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData).to.have.property('status');\r",
									"    pm.expect(jsonData).to.have.property('data');\r",
									"    pm.expect(jsonData.data).to.have.property('pendingWithConfirmations');\r",
									"    pm.expect(jsonData.data).to.have.property('pendingWithReversals');\r",
									"    pm.expect(jsonData.data).to.have.property('pendingWithRefunds');\r",
									"    pm.expect(jsonData.data).to.have.property('orphanedSettlements');\r",
									"    pm.expect(jsonData.data).to.have.property('totalInconsistencies');\r",
									"    pm.expect(jsonData.data).to.have.property('hasInconsistencies');\r",
									"})\r",
									"\r",
									"pm.test(\"inconsistency counts are non-negative\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.data.pendingWithConfirmations).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.pendingWithReversals).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.pendingWithRefunds).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.orphanedSettlements).to.be.at.least(0);\r",
									"})"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-api-key",
								"value": "{{ADMIN_API_KEY}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/admin/data-cleansing/report",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"admin",
								"data-cleansing",
								"report"
							]
						},
						"description": "Generate a report of data inconsistencies without fixing anything. This is a safe read-only operation."
					},
					"response": [
						{
							"name": "Success Response - No Issues",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"No data inconsistencies found. Database is clean.\",\n    \"data\": {\n        \"pendingWithConfirmations\": 0,\n        \"pendingWithReversals\": 0,\n        \"pendingWithRefunds\": 0,\n        \"orphanedSettlements\": 0,\n        \"totalInconsistencies\": 0,\n        \"hasInconsistencies\": false\n    }\n}"
						},
						{
							"name": "Success Response - Issues Found",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"Data inconsistencies found. Consider running the cleanse operation.\",\n    \"data\": {\n        \"pendingWithConfirmations\": 5,\n        \"pendingWithReversals\": 2,\n        \"pendingWithRefunds\": 1,\n        \"orphanedSettlements\": 3,\n        \"totalInconsistencies\": 11,\n        \"hasInconsistencies\": true\n    }\n}"
						}
					]
				},
				{
					"name": "Generate Health Report",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"response is ok\",  ()=>{\r",
									"    pm.response.to.have.status(200)\r",
									"})\r",
									"\r",
									"pm.test(\"response has correct structure\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData).to.have.property('status');\r",
									"    pm.expect(jsonData).to.have.property('data');\r",
									"    pm.expect(jsonData.data).to.have.property('overallHealth');\r",
									"    pm.expect(jsonData.data).to.have.property('inconsistencyReport');\r",
									"    pm.expect(jsonData.data).to.have.property('recommendations');\r",
									"    pm.expect(jsonData.data).to.have.property('reportGeneratedAt');\r",
									"})\r",
									"\r",
									"pm.test(\"overall health is valid\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(['HEALTHY', 'UNHEALTHY']).to.include(jsonData.data.overallHealth);\r",
									"})\r",
									"\r",
									"pm.test(\"recommendations is an array\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.data.recommendations).to.be.an('array');\r",
									"})"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-api-key",
								"value": "{{ADMIN_API_KEY}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/admin/data-cleansing/health-report",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"admin",
								"data-cleansing",
								"health-report"
							]
						},
						"description": "Generate a comprehensive data health report with recommendations. This is a safe read-only operation."
					},
					"response": [
						{
							"name": "Success Response - Healthy Database",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"Data health report generated successfully\",\n    \"data\": {\n        \"overallHealth\": \"HEALTHY\",\n        \"inconsistencyReport\": {\n            \"pendingWithConfirmations\": 0,\n            \"pendingWithReversals\": 0,\n            \"pendingWithRefunds\": 0,\n            \"orphanedSettlements\": 0,\n            \"totalInconsistencies\": 0,\n            \"hasInconsistencies\": false\n        },\n        \"recommendations\": [\n            \"Database is healthy. No action required.\"\n        ],\n        \"reportGeneratedAt\": 1703123456789\n    }\n}"
						},
						{
							"name": "Success Response - Unhealthy Database",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"Data health report generated successfully\",\n    \"data\": {\n        \"overallHealth\": \"UNHEALTHY\",\n        \"inconsistencyReport\": {\n            \"pendingWithConfirmations\": 5,\n            \"pendingWithReversals\": 2,\n            \"pendingWithRefunds\": 1,\n            \"orphanedSettlements\": 3,\n            \"totalInconsistencies\": 11,\n            \"hasInconsistencies\": true\n        },\n        \"recommendations\": [\n            \"Fix pending debit transactions with confirmations. Fix pending debit transactions with reversals. Fix pending debit transactions with refunds. Investigate orphaned settlement transactions. Consider running the data cleansing operation to fix these issues automatically.\"\n        ],\n        \"reportGeneratedAt\": 1703123456789\n    }\n}"
						}
					]
				}
			]
		},
		{
			"name": "Data Cleansing Operations",
			"item": [
				{
					"name": "Cleanse Gift Card Transactions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"response is ok\",  ()=>{\r",
									"    pm.response.to.have.status(200)\r",
									"})\r",
									"\r",
									"pm.test(\"response has correct structure\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData).to.have.property('status');\r",
									"    pm.expect(jsonData).to.have.property('data');\r",
									"    pm.expect(jsonData.data).to.have.property('success');\r",
									"    pm.expect(jsonData.data).to.have.property('confirmedTransactionsFixed');\r",
									"    pm.expect(jsonData.data).to.have.property('reversedTransactionsFixed');\r",
									"    pm.expect(jsonData.data).to.have.property('refundedTransactionsFixed');\r",
									"    pm.expect(jsonData.data).to.have.property('orphanedTransactionsFixed');\r",
									"    pm.expect(jsonData.data).to.have.property('totalFixed');\r",
									"    pm.expect(jsonData.data).to.have.property('executionTime');\r",
									"})\r",
									"\r",
									"pm.test(\"success flag is boolean\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.data.success).to.be.a('boolean');\r",
									"})\r",
									"\r",
									"pm.test(\"counts are non-negative\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.data.confirmedTransactionsFixed).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.reversedTransactionsFixed).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.refundedTransactionsFixed).to.be.at.least(0);\r",
									"    pm.expect(jsonData.data.orphanedTransactionsFixed).to.be.at.least(0);\r",
									"})\r",
									"\r",
									"pm.test(\"execution time is positive\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    pm.expect(jsonData.data.executionTime).to.be.at.least(0);\r",
									"})\r",
									"\r",
									"pm.test(\"total fixed matches sum\",  ()=>{\r",
									"    var jsonData = pm.response.json();\r",
									"    var expectedTotal = jsonData.data.confirmedTransactionsFixed + \r",
									"                       jsonData.data.reversedTransactionsFixed + \r",
									"                       jsonData.data.refundedTransactionsFixed + \r",
									"                       jsonData.data.orphanedTransactionsFixed;\r",
									"    pm.expect(jsonData.data.totalFixed).to.equal(expectedTotal);\r",
									"})"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}",
								"type": "text"
							},
							{
								"key": "Content-Type",
								"value": "application/json",
								"type": "text"
							},
							{
								"key": "x-api-key",
								"value": "{{ADMIN_API_KEY}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/admin/data-cleansing/cleanse-giftcard-transactions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"admin",
								"data-cleansing",
								"cleanse-giftcard-transactions"
							]
						},
						"description": "Execute data cleansing operations to fix inconsistent transaction statuses. This operation modifies the database and should be used with caution."
					},
					"response": [
						{
							"name": "Success Response - Issues Fixed",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"Data cleansing completed successfully. Fixed 11 transactions in 1500 ms\",\n    \"data\": {\n        \"success\": true,\n        \"errorMessage\": null,\n        \"confirmedTransactionsFixed\": 5,\n        \"reversedTransactionsFixed\": 2,\n        \"refundedTransactionsFixed\": 1,\n        \"orphanedTransactionsFixed\": 3,\n        \"totalFixed\": 11,\n        \"executionTime\": 1500\n    }\n}"
						},
						{
							"name": "Success Response - No Issues Found",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": 0,\n    \"message\": \"Data cleansing completed. No issues found to fix.\",\n    \"data\": {\n        \"success\": true,\n        \"errorMessage\": null,\n        \"confirmedTransactionsFixed\": 0,\n        \"reversedTransactionsFixed\": 0,\n        \"refundedTransactionsFixed\": 0,\n        \"orphanedTransactionsFixed\": 0,\n        \"totalFixed\": 0,\n        \"executionTime\": 45\n    }\n}"
						},
						{
							"name": "Error Response",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": ""
								},
								"url": {
									"raw": ""
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"status\": -1,\n    \"message\": \"Data cleansing failed: Database connection error\",\n    \"data\": {\n        \"success\": false,\n        \"errorMessage\": \"Error during cleansing: Database connection error\",\n        \"confirmedTransactionsFixed\": 0,\n        \"reversedTransactionsFixed\": 0,\n        \"refundedTransactionsFixed\": 0,\n        \"orphanedTransactionsFixed\": 0,\n        \"totalFixed\": 0,\n        \"executionTime\": 0\n    }\n}"
						}
					]
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "token",
			"value": "your-jwt-token",
			"type": "string"
		},
		{
			"key": "ADMIN_API_KEY",
			"value": "your-admin-api-key",
			"type": "string"
		}
	]
}
